"use strict";

function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
(function () {
  var PROMO_END_DATE = new Date('2024-05-18T22:30:00.000Z');
  var apiURL = 'https://fav-prom.com/api_guessfight_hr';
  var resultsTable = document.querySelector('.tableResults__body'),
    unauthMsgs = document.querySelectorAll('.unauth-msg'),
    youAreInBtns = document.querySelectorAll('.took-part'),
    predictionBtn = document.querySelector('.predictBtn'),
    itemsTeams = document.querySelectorAll('.forecast__list button');
  var hrLeng = document.querySelector('#hrLeng');
  var locale = 'hr';
  if (hrLeng) locale = 'hr';
  var i18nData = {};
  var userId;
  // userId = 10101010;
  var scorePrediction = {
    team: 1
  };
  var teamNamesById = [];
  function loadTranslations() {
    return fetch("".concat(apiURL, "/translates/").concat(locale)).then(function (res) {
      return res.json();
    }).then(function (json) {
      i18nData = json;
      translate();
      var mutationObserver = new MutationObserver(function (mutations) {
        translate();
      });
      mutationObserver.observe(document.getElementById('predictor'), {
        childList: true,
        subtree: true
      });
    });
  }
  function translate() {
    var elems = document.querySelectorAll('[data-translate]');
    if (elems && elems.length) {
      elems.forEach(function (elem) {
        var key = elem.getAttribute('data-translate');
        elem.innerHTML = translateKey(key);
        elem.removeAttribute('data-translate');
      });
    }
    if (locale === 'en') {
      mainPage.classList.add('en');
    }
    refreshLocalizedClass();
  }
  function translateKey(key) {
    if (!key) {
      return;
    }
    return i18nData[key] || '*----NEED TO BE TRANSLATED----*   key:  ' + key;
  }
  function refreshLocalizedClass(element, baseCssClass) {
    if (!element) {
      return;
    }
    for (var _i = 0, _arr = ['hr']; _i < _arr.length; _i++) {
      var lang = _arr[_i];
      element.classList.remove(baseCssClass + lang);
    }
    element.classList.add(baseCssClass + locale);
  }
  var request = function request(link, extraOptions) {
    return fetch(apiURL + link, _objectSpread({
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      }
    }, extraOptions || {})).then(function (res) {
      return res.json();
    });
  };
  function getUsers() {
    return request('/users');
  }
  var InitPage = function InitPage() {
    getUsers().then(function (users) {
      renderUsers(users);
      translate();
    });
  };
  function init() {
    initDrop();
    initPredictionBtn();
    if (window.store) {
      var state = window.store.getState();
      userId = state.auth.isAuthorized && state.auth.id || '';
      InitPage();
    } else {
      InitPage();
      var c = 0;
      var i = setInterval(function () {
        if (c < 50) {
          if (!!window.g_user_id) {
            userId = window.g_user_id;
            InitPage();
            checkUserAuth();
            clearInterval(i);
          }
        } else {
          clearInterval(i);
        }
      }, 200);
    }
    checkUserAuth();
  }
  function renderUsers(users) {
    populateUsersTable(users, userId, resultsTable);
  }
  function populateUsersTable(users, currentUserId, table) {
    table.innerHTML = '';
    if (users && users.length) {
      var currentUser = userId && users.find(function (user) {
        return user.userid === currentUserId;
      });
      if (currentUser) {
        displayUser(currentUser, true, table);
      }
      users.forEach(function (user) {
        if (user.userid !== currentUserId) {
          displayUser(user, false, table);
        }
      });
    }
  }
  function displayUser(user, isCurrentUser, table) {
    var additionalUserRow = document.createElement('div');
    additionalUserRow.classList.add('tableResults__row');
    var selectedTeam = user.team && user.team > 0 ? teamNamesById[user.team] : '';
    if (isCurrentUser) {
      updateLastPrediction(selectedTeam);
      refreshDrop(user.team);
      additionalUserRow.classList.add('_yourPlace');
    }
    additionalUserRow.innerHTML = "\n                        <div class=\"tableResults__body-col\">".concat(isCurrentUser ? user.userid : maskUserId(user.userid), "</div>\n                        <div class=\"tableResults__body-col\">").concat(formatDateString(user.lastForecast), "</div>\n                        <div class=\"tableResults__body-col\">").concat(selectedTeam, "</div>\n                        <div class=\"tableResults__body-col\">************</div>\n                    ");
    table.append(additionalUserRow);
  }
  function updateLastPrediction(team) {
    var forecastLogDiv = document.querySelector('.forecast__des');
    if (team) {
      forecastLogDiv.classList.remove('hide');
      var lastPredictionLabel = document.getElementById('roundWinner');
      lastPredictionLabel.innerHTML = "".concat(team);
    } else {
      forecastLogDiv.classList.add('hide');
    }
  }
  function refreshDrop(predictedTeam) {
    var regex = /“([^“”]+)”/;
    scorePrediction.team = predictedTeam;
    itemsTeams.forEach(function (item) {
      item.classList.remove('active');
      var teamId = +item.dataset.teamId;
      if (predictedTeam === teamId) {
        item.classList.add('active');
      }
    });
  }
  function formatDateString(dateString) {
    var date = new Date(dateString);
    var day = date.getDate().toString().padStart(2, '0');
    var month = (date.getMonth() + 1).toString().padStart(2, '0');
    var year = date.getFullYear();
    var hours = date.getHours().toString().padStart(2, '0');
    var minutes = date.getMinutes().toString().padStart(2, '0');
    return "".concat(day, ".").concat(month, ".").concat(year, " / ").concat(hours, ":").concat(minutes);
  }
  function maskUserId(userId) {
    return "**" + userId.toString().slice(2);
  }
  function checkUserAuth() {
    return request("/favuser/".concat(userId, "?nocache=1")).then(function (res) {
      if (res.userid) {
        console.log(userId === res.userid);
        if (res.userid == userId) {
          confirmBet(res.betConfirmed);
        }
        unauthMsgs.forEach(function (item) {
          return item.classList.add('hide');
        });
        youAreInBtns.forEach(function (item) {
          return item.classList.remove('hide');
        });
      } else {
        unauthMsgs.forEach(function (item) {
          return item.classList.remove('hide');
        });
        youAreInBtns.forEach(function (item) {
          return item.classList.add('hide');
        });
      }
    });
  }

  //custom drop
  function initDrop() {
    var regex = /“([^“”]+)”/;
    itemsTeams.forEach(function (item) {
      var teamId = +item.dataset.teamId;
      teamNamesById[teamId] = item.innerHTML;
      item.addEventListener('click', function () {
        itemsTeams.forEach(function (el) {
          el.classList.remove('active');
        });
        scorePrediction.team = teamId;
        item.classList.add('active');
      });
    });
  }
  var isRequestInProgress;
  function initPredictionBtn() {
    document.addEventListener('click', function (e) {
      if (!!e.target.closest('.predictBtn')) {
        if (isRequestInProgress) {
          return;
        }
        setTimeout(function () {
          youAreInBtns.forEach(function (item) {
            return item.classList.remove('showBtn');
          });
        }, 5000);
        youAreInBtns.forEach(function (item) {
          return item.classList.add('showBtn');
        });
        isRequestInProgress = true;
        predictionBtn.classList.add("pointer-none");
        request('/bet', {
          method: 'POST',
          body: JSON.stringify({
            userid: userId,
            team: scorePrediction.team
          })
        }).then(function (res) {
          isRequestInProgress = false;
          predictionBtn.classList.remove("pointer-none");
          InitPage();
        })["catch"](function (e) {
          isRequestInProgress = false;
          predictionBtn.classList.remove("pointer-none");
        });
      }
    });
  }
  loadTranslations().then(init);
  function confirmBet(bet) {
    var betWrap = document.querySelector(".forecast__question");
    var betTrue = document.querySelector(".forecast__question-item-green");
    var betFalse = document.querySelector(".forecast__question-item-orange");
    betWrap.classList.remove("hide");
    betTrue.classList.remove("active");
    betFalse.classList.remove("active");
    if (bet) {
      betTrue.classList.add("active");
    } else {
      betFalse.classList.add("active");
    }
  }
  var mainPage = document.querySelector('.fav__page');
  setTimeout(function () {
    return mainPage.classList.add('overflow');
  }, 1000);
  var currentDate = new Date();
  if (currentDate >= PROMO_END_DATE) {
    predictionBtn.classList.add('blockBtn');
  }
})();
"use strict";
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJzZWNvbmQuanMiXSwibmFtZXMiOlsiUFJPTU9fRU5EX0RBVEUiLCJEYXRlIiwiYXBpVVJMIiwicmVzdWx0c1RhYmxlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwidW5hdXRoTXNncyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJ5b3VBcmVJbkJ0bnMiLCJwcmVkaWN0aW9uQnRuIiwiaXRlbXNUZWFtcyIsImhyTGVuZyIsImxvY2FsZSIsImkxOG5EYXRhIiwidXNlcklkIiwic2NvcmVQcmVkaWN0aW9uIiwidGVhbSIsInRlYW1OYW1lc0J5SWQiLCJsb2FkVHJhbnNsYXRpb25zIiwiZmV0Y2giLCJjb25jYXQiLCJ0aGVuIiwicmVzIiwianNvbiIsInRyYW5zbGF0ZSIsIm11dGF0aW9uT2JzZXJ2ZXIiLCJNdXRhdGlvbk9ic2VydmVyIiwibXV0YXRpb25zIiwib2JzZXJ2ZSIsImdldEVsZW1lbnRCeUlkIiwiY2hpbGRMaXN0Iiwic3VidHJlZSIsImVsZW1zIiwibGVuZ3RoIiwiZm9yRWFjaCIsImVsZW0iLCJrZXkiLCJnZXRBdHRyaWJ1dGUiLCJpbm5lckhUTUwiLCJ0cmFuc2xhdGVLZXkiLCJyZW1vdmVBdHRyaWJ1dGUiLCJtYWluUGFnZSIsImNsYXNzTGlzdCIsImFkZCIsInJlZnJlc2hMb2NhbGl6ZWRDbGFzcyIsImVsZW1lbnQiLCJiYXNlQ3NzQ2xhc3MiLCJfaSIsIl9hcnIiLCJsYW5nIiwicmVtb3ZlIiwicmVxdWVzdCIsImxpbmsiLCJleHRyYU9wdGlvbnMiLCJfb2JqZWN0U3ByZWFkIiwiaGVhZGVycyIsImdldFVzZXJzIiwiSW5pdFBhZ2UiLCJ1c2VycyIsInJlbmRlclVzZXJzIiwiaW5pdCIsImluaXREcm9wIiwiaW5pdFByZWRpY3Rpb25CdG4iLCJ3aW5kb3ciLCJzdG9yZSIsInN0YXRlIiwiZ2V0U3RhdGUiLCJhdXRoIiwiaXNBdXRob3JpemVkIiwiaWQiLCJjIiwiaSIsInNldEludGVydmFsIiwiZ191c2VyX2lkIiwiY2hlY2tVc2VyQXV0aCIsImNsZWFySW50ZXJ2YWwiLCJwb3B1bGF0ZVVzZXJzVGFibGUiLCJjdXJyZW50VXNlcklkIiwidGFibGUiLCJjdXJyZW50VXNlciIsImZpbmQiLCJ1c2VyIiwidXNlcmlkIiwiZGlzcGxheVVzZXIiLCJpc0N1cnJlbnRVc2VyIiwiYWRkaXRpb25hbFVzZXJSb3ciLCJjcmVhdGVFbGVtZW50Iiwic2VsZWN0ZWRUZWFtIiwidXBkYXRlTGFzdFByZWRpY3Rpb24iLCJyZWZyZXNoRHJvcCIsIm1hc2tVc2VySWQiLCJmb3JtYXREYXRlU3RyaW5nIiwibGFzdEZvcmVjYXN0IiwiYXBwZW5kIiwiZm9yZWNhc3RMb2dEaXYiLCJsYXN0UHJlZGljdGlvbkxhYmVsIiwicHJlZGljdGVkVGVhbSIsInJlZ2V4IiwiaXRlbSIsInRlYW1JZCIsImRhdGFzZXQiLCJkYXRlU3RyaW5nIiwiZGF0ZSIsImRheSIsImdldERhdGUiLCJ0b1N0cmluZyIsInBhZFN0YXJ0IiwibW9udGgiLCJnZXRNb250aCIsInllYXIiLCJnZXRGdWxsWWVhciIsImhvdXJzIiwiZ2V0SG91cnMiLCJtaW51dGVzIiwiZ2V0TWludXRlcyIsInNsaWNlIiwiY29uc29sZSIsImxvZyIsImNvbmZpcm1CZXQiLCJiZXRDb25maXJtZWQiLCJhZGRFdmVudExpc3RlbmVyIiwiZWwiLCJpc1JlcXVlc3RJblByb2dyZXNzIiwiZSIsInRhcmdldCIsImNsb3Nlc3QiLCJzZXRUaW1lb3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJiZXQiLCJiZXRXcmFwIiwiYmV0VHJ1ZSIsImJldEZhbHNlIiwiY3VycmVudERhdGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsQ0FBQyxZQUFZO0VBQ1QsSUFBTUEsY0FBYyxHQUFHLElBQUlDLElBQUksQ0FBQywwQkFBMEIsQ0FBQztFQUMzRCxJQUFNQyxNQUFNLEdBQUcsd0NBQXdDO0VBRXZELElBQ0lDLFlBQVksR0FBR0MsUUFBUSxDQUFDQyxhQUFhLENBQUMscUJBQXFCLENB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QUFDQyxHQUFHLENBQUMsVUFBVSxDQUFDO0VBQzNDO0FBQ0osQ0FBQyxFQUFFLENBQUM7QUN6U0oiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgUFJPTU9fRU5EX0RBVEUgPSBuZXcgRGF0ZSgnMjAyNC0wNS0xOFQyMjozMDowMC4wMDBaJyk7XG4gICAgY29uc3QgYXBpVVJMID0gJ2h0dHBzOi8vZmF2LXByb20uY29tL2FwaV9ndWVzc2ZpZ2h0X2hyJztcblxuICAgIGNvbnN0XG4gICAgICAgIHJlc3VsdHNUYWJsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50YWJsZVJlc3VsdHNfX2JvZHknKSxcbiAgICAgICAgdW5hdXRoTXNncyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy51bmF1dGgtbXNnJyksXG4gICAgICAgIHlvdUFyZUluQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50b29rLXBhcnQnKSxcbiAgICAgICAgcHJlZGljdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcmVkaWN0QnRuJyksXG4gICAgICAgIGl0ZW1zVGVhbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZm9yZWNhc3RfX2xpc3QgYnV0dG9uJyk7XG5cbiAgICBjb25zdCBockxlbmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaHJMZW5nJyk7XG5cbiAgICBsZXQgbG9jYWxlID0gJ2hyJztcblxuICAgIGlmIChockxlbmcpIGxvY2FsZSA9ICdocic7XG5cbiAgICBsZXQgaTE4bkRhdGEgPSB7fTtcbiAgICBsZXQgdXNlcklkO1xuICAgIC8vIHVzZXJJZCA9IDEwMTAxMDEwO1xuICAgIGNvbnN0IHNjb3JlUHJlZGljdGlvbiA9IHt0ZWFtIDogMX07XG4gICAgY29uc3QgdGVhbU5hbWVzQnlJZCA9IFtdO1xuXG4gICAgZnVuY3Rpb24gbG9hZFRyYW5zbGF0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke2FwaVVSTH0vdHJhbnNsYXRlcy8ke2xvY2FsZX1gKS50aGVuKHJlcyA9PiByZXMuanNvbigpKVxuICAgICAgICAgICAgLnRoZW4oanNvbiA9PiB7XG4gICAgICAgICAgICAgICAgaTE4bkRhdGEgPSBqc29uO1xuICAgICAgICAgICAgICAgIHRyYW5zbGF0ZSgpO1xuXG4gICAgICAgICAgICAgICAgdmFyIG11dGF0aW9uT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbiAobXV0YXRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIG11dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJlZGljdG9yJyksIHtcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzdWJ0cmVlOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0cmFuc2xhdGUoKSB7XG4gICAgICAgIGNvbnN0IGVsZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtdHJhbnNsYXRlXScpXG4gICAgICAgIGlmIChlbGVtcyAmJiBlbGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGVsZW1zLmZvckVhY2goZWxlbSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdHJhbnNsYXRlJyk7XG4gICAgICAgICAgICAgICAgZWxlbS5pbm5lckhUTUwgPSB0cmFuc2xhdGVLZXkoa2V5KTtcbiAgICAgICAgICAgICAgICBlbGVtLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS10cmFuc2xhdGUnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBpZiAobG9jYWxlID09PSAnZW4nKSB7XG4gICAgICAgICAgICBtYWluUGFnZS5jbGFzc0xpc3QuYWRkKCdlbicpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVmcmVzaExvY2FsaXplZENsYXNzKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdHJhbnNsYXRlS2V5KGtleSkge1xuICAgICAgICBpZiAoIWtleSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpMThuRGF0YVtrZXldIHx8ICcqLS0tLU5FRUQgVE8gQkUgVFJBTlNMQVRFRC0tLS0qICAga2V5OiAgJyArIGtleTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWZyZXNoTG9jYWxpemVkQ2xhc3MoZWxlbWVudCwgYmFzZUNzc0NsYXNzKSB7XG4gICAgICAgIGlmICghZWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgbGFuZyBvZiBbJ2hyJ10pIHtcbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShiYXNlQ3NzQ2xhc3MgKyBsYW5nKTtcbiAgICAgICAgfVxuICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoYmFzZUNzc0NsYXNzICsgbG9jYWxlKTtcbiAgICB9XG5cbiAgICBjb25zdCByZXF1ZXN0ID0gZnVuY3Rpb24gKGxpbmssIGV4dHJhT3B0aW9ucykge1xuICAgICAgICByZXR1cm4gZmV0Y2goYXBpVVJMICsgbGluaywge1xuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC4uLihleHRyYU9wdGlvbnMgfHwge30pXG4gICAgICAgIH0pLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0VXNlcnMoKSB7XG4gICAgICAgIHJldHVybiByZXF1ZXN0KCcvdXNlcnMnKTtcbiAgICB9XG5cbiAgICBjb25zdCBJbml0UGFnZSA9ICgpID0+IHtcbiAgICAgICAgZ2V0VXNlcnMoKS50aGVuKHVzZXJzID0+IHtcbiAgICAgICAgICAgIHJlbmRlclVzZXJzKHVzZXJzKTtcbiAgICAgICAgICAgIHRyYW5zbGF0ZSgpO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgIGluaXREcm9wKCk7XG4gICAgICAgIGluaXRQcmVkaWN0aW9uQnRuKCk7XG5cbiAgICAgICAgaWYgKHdpbmRvdy5zdG9yZSkge1xuICAgICAgICAgICAgdmFyIHN0YXRlID0gd2luZG93LnN0b3JlLmdldFN0YXRlKCk7XG4gICAgICAgICAgICB1c2VySWQgPSBzdGF0ZS5hdXRoLmlzQXV0aG9yaXplZCAmJiBzdGF0ZS5hdXRoLmlkIHx8ICcnO1xuICAgICAgICAgICAgSW5pdFBhZ2UoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIEluaXRQYWdlKCk7XG4gICAgICAgICAgICBsZXQgYyA9IDA7XG4gICAgICAgICAgICB2YXIgaSA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoYyA8IDUwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghIXdpbmRvdy5nX3VzZXJfaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZCA9IHdpbmRvdy5nX3VzZXJfaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBJbml0UGFnZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tVc2VyQXV0aCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMjAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNoZWNrVXNlckF1dGgoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZW5kZXJVc2Vycyh1c2Vycykge1xuICAgICAgICBwb3B1bGF0ZVVzZXJzVGFibGUodXNlcnMsIHVzZXJJZCwgcmVzdWx0c1RhYmxlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwb3B1bGF0ZVVzZXJzVGFibGUodXNlcnMsIGN1cnJlbnRVc2VySWQsIHRhYmxlKSB7XG4gICAgICAgIHRhYmxlLmlubmVySFRNTCA9ICcnO1xuICAgICAgICBpZiAodXNlcnMgJiYgdXNlcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50VXNlciA9IHVzZXJJZCAmJiB1c2Vycy5maW5kKHVzZXIgPT4gdXNlci51c2VyaWQgPT09IGN1cnJlbnRVc2VySWQpO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheVVzZXIoY3VycmVudFVzZXIsIHRydWUsIHRhYmxlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdXNlcnMuZm9yRWFjaCgodXNlcikgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh1c2VyLnVzZXJpZCAhPT0gY3VycmVudFVzZXJJZCkge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5VXNlcih1c2VyLCBmYWxzZSwgdGFibGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGlzcGxheVVzZXIodXNlciwgaXNDdXJyZW50VXNlciwgdGFibGUpIHtcbiAgICAgICAgY29uc3QgYWRkaXRpb25hbFVzZXJSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgYWRkaXRpb25hbFVzZXJSb3cuY2xhc3NMaXN0LmFkZCgndGFibGVSZXN1bHRzX19yb3cnKTtcblxuICAgICAgICBjb25zdCBzZWxlY3RlZFRlYW0gPSB1c2VyLnRlYW0gJiYgdXNlci50ZWFtID4gMCA/IHRlYW1OYW1lc0J5SWRbdXNlci50ZWFtXSA6ICcnO1xuICAgICAgICBpZiAoaXNDdXJyZW50VXNlcikge1xuICAgICAgICAgICAgdXBkYXRlTGFzdFByZWRpY3Rpb24oc2VsZWN0ZWRUZWFtKTtcbiAgICAgICAgICAgIHJlZnJlc2hEcm9wKHVzZXIudGVhbSk7XG4gICAgICAgICAgICBhZGRpdGlvbmFsVXNlclJvdy5jbGFzc0xpc3QuYWRkKCdfeW91clBsYWNlJyk7XG4gICAgICAgIH1cblxuICAgICAgICBhZGRpdGlvbmFsVXNlclJvdy5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGFibGVSZXN1bHRzX19ib2R5LWNvbFwiPiR7aXNDdXJyZW50VXNlciA/IHVzZXIudXNlcmlkIDogbWFza1VzZXJJZCh1c2VyLnVzZXJpZCl9PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGFibGVSZXN1bHRzX19ib2R5LWNvbFwiPiR7Zm9ybWF0RGF0ZVN0cmluZyh1c2VyLmxhc3RGb3JlY2FzdCl9PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGFibGVSZXN1bHRzX19ib2R5LWNvbFwiPiR7c2VsZWN0ZWRUZWFtfTwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRhYmxlUmVzdWx0c19fYm9keS1jb2xcIj4qKioqKioqKioqKio8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgYDtcbiAgICAgICAgdGFibGUuYXBwZW5kKGFkZGl0aW9uYWxVc2VyUm93KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB1cGRhdGVMYXN0UHJlZGljdGlvbih0ZWFtKSB7XG4gICAgICAgIGNvbnN0IGZvcmVjYXN0TG9nRGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcmVjYXN0X19kZXMnKTtcbiAgICAgICAgaWYgKHRlYW0pIHtcbiAgICAgICAgICAgIGZvcmVjYXN0TG9nRGl2LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgICAgICAgIGNvbnN0IGxhc3RQcmVkaWN0aW9uTGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm91bmRXaW5uZXInKTtcbiAgICAgICAgICAgIGxhc3RQcmVkaWN0aW9uTGFiZWwuaW5uZXJIVE1MID0gYCR7dGVhbX1gO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yZWNhc3RMb2dEaXYuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVmcmVzaERyb3AocHJlZGljdGVkVGVhbSkge1xuICAgICAgICBjb25zdCByZWdleCA9IC/igJwoW17igJzigJ1dKynigJ0vO1xuICAgICAgICBzY29yZVByZWRpY3Rpb24udGVhbSA9IHByZWRpY3RlZFRlYW07XG5cbiAgICAgICAgaXRlbXNUZWFtcy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIGNvbnN0IHRlYW1JZCA9ICtpdGVtLmRhdGFzZXQudGVhbUlkO1xuICAgICAgICAgICAgaWYgKHByZWRpY3RlZFRlYW0gPT09IHRlYW1JZCkge1xuICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGZvcm1hdERhdGVTdHJpbmcoZGF0ZVN0cmluZykge1xuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoZGF0ZVN0cmluZyk7XG5cbiAgICAgICAgY29uc3QgZGF5ID0gZGF0ZS5nZXREYXRlKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpO1xuICAgICAgICBjb25zdCBtb250aCA9IChkYXRlLmdldE1vbnRoKCkgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7XG4gICAgICAgIGNvbnN0IHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgICAgIGNvbnN0IGhvdXJzID0gZGF0ZS5nZXRIb3VycygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTtcbiAgICAgICAgY29uc3QgbWludXRlcyA9IGRhdGUuZ2V0TWludXRlcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTtcblxuICAgICAgICByZXR1cm4gYCR7ZGF5fS4ke21vbnRofS4ke3llYXJ9IC8gJHtob3Vyc306JHttaW51dGVzfWA7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWFza1VzZXJJZCh1c2VySWQpIHtcbiAgICAgICAgcmV0dXJuIFwiKipcIiArIHVzZXJJZC50b1N0cmluZygpLnNsaWNlKDIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNoZWNrVXNlckF1dGgoKSB7XG4gICAgICAgIHJldHVybiByZXF1ZXN0KGAvZmF2dXNlci8ke3VzZXJJZH0/bm9jYWNoZT0xYClcbiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7XG5cbiAgICAgICAgICAgICAgICBpZiAocmVzLnVzZXJpZCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh1c2VySWQgPT09IHJlcy51c2VyaWQpXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlcy51c2VyaWQgPT0gdXNlcklkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CZXQocmVzLmJldENvbmZpcm1lZClcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHVuYXV0aE1zZ3MuZm9yRWFjaChpdGVtID0+IGl0ZW0uY2xhc3NMaXN0LmFkZCgnaGlkZScpKTtcbiAgICAgICAgICAgICAgICAgICAgeW91QXJlSW5CdG5zLmZvckVhY2goaXRlbSA9PiBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdW5hdXRoTXNncy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJykpO1xuICAgICAgICAgICAgICAgICAgICB5b3VBcmVJbkJ0bnMuZm9yRWFjaChpdGVtID0+IGl0ZW0uY2xhc3NMaXN0LmFkZCgnaGlkZScpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgIH1cblxuXG4gICAgLy9jdXN0b20gZHJvcFxuICAgIGZ1bmN0aW9uIGluaXREcm9wKCkge1xuICAgICAgICBjb25zdCByZWdleCA9IC/igJwoW17igJzigJ1dKynigJ0vO1xuXG4gICAgICAgIGl0ZW1zVGVhbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRlYW1JZCA9ICtpdGVtLmRhdGFzZXQudGVhbUlkO1xuICAgICAgICAgICAgdGVhbU5hbWVzQnlJZFt0ZWFtSWRdID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaXRlbXNUZWFtcy5mb3JFYWNoKGVsID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJylcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIHNjb3JlUHJlZGljdGlvbi50ZWFtID0gdGVhbUlkO1xuICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJylcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGxldCBpc1JlcXVlc3RJblByb2dyZXNzO1xuICAgIGZ1bmN0aW9uIGluaXRQcmVkaWN0aW9uQnRuKCkge1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBpZiAoISFlLnRhcmdldC5jbG9zZXN0KCcucHJlZGljdEJ0bicpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzUmVxdWVzdEluUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHlvdUFyZUluQnRucy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdzaG93QnRuJykpO1xuICAgICAgICAgICAgICAgIH0sIDUwMDApO1xuICAgICAgICAgICAgICAgIHlvdUFyZUluQnRucy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5jbGFzc0xpc3QuYWRkKCdzaG93QnRuJykpO1xuICAgICAgICAgICAgICAgIGlzUmVxdWVzdEluUHJvZ3Jlc3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHByZWRpY3Rpb25CdG4uY2xhc3NMaXN0LmFkZChcInBvaW50ZXItbm9uZVwiKTtcbiAgICAgICAgICAgICAgICByZXF1ZXN0KCcvYmV0Jywge1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcmlkOiB1c2VySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZWFtOiBzY29yZVByZWRpY3Rpb24udGVhbVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaXNSZXF1ZXN0SW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBwcmVkaWN0aW9uQnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJwb2ludGVyLW5vbmVcIik7XG4gICAgICAgICAgICAgICAgICAgIEluaXRQYWdlKCk7XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlzUmVxdWVzdEluUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcHJlZGljdGlvbkJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwicG9pbnRlci1ub25lXCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBsb2FkVHJhbnNsYXRpb25zKClcbiAgICAgICAgLnRoZW4oaW5pdCk7XG5cbiAgICBmdW5jdGlvbiBjb25maXJtQmV0KGJldCl7XG4gICAgICAgIGNvbnN0IGJldFdyYXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmZvcmVjYXN0X19xdWVzdGlvblwiKVxuICAgICAgICBjb25zdCBiZXRUcnVlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5mb3JlY2FzdF9fcXVlc3Rpb24taXRlbS1ncmVlblwiKVxuICAgICAgICBjb25zdCBiZXRGYWxzZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZm9yZWNhc3RfX3F1ZXN0aW9uLWl0ZW0tb3JhbmdlXCIpXG4gICAgICAgIGJldFdyYXAuY2xhc3NMaXN0LnJlbW92ZShcImhpZGVcIilcbiAgICAgICAgYmV0VHJ1ZS5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpXG4gICAgICAgIGJldEZhbHNlLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIilcbiAgICAgICAgaWYoYmV0KXtcbiAgICAgICAgICAgIGJldFRydWUuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGJldEZhbHNlLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIilcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgbGV0IG1haW5QYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZhdl9fcGFnZScpO1xuICAgIHNldFRpbWVvdXQoKCkgPT4gbWFpblBhZ2UuY2xhc3NMaXN0LmFkZCgnb3ZlcmZsb3cnKSwgMTAwMCk7XG5cbiAgICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgaWYoY3VycmVudERhdGUgPj0gUFJPTU9fRU5EX0RBVEUpIHtcbiAgICAgICAgcHJlZGljdGlvbkJ0bi5jbGFzc0xpc3QuYWRkKCdibG9ja0J0bicpO1xuICAgIH1cbn0pKCk7XG4iLCIiXX0=
